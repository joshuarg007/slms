!function(){"use strict";const n=document.currentScript,e=n?.getAttribute("data-widget-key");if(!e)return void console.error("Site2CRM Chat Widget: Missing data-widget-key attribute");const t=n?.getAttribute("data-exclude-paths");if(t){const n=window.location.pathname,e=t.split(",").map(n=>n.trim());for(const t of e)if(t.endsWith("*")){const e=t.slice(0,-1);if(n.startsWith(e))return void console.log("Site2CRM Chat Widget: Hidden on excluded path",n)}else if(n===t)return void console.log("Site2CRM Chat Widget: Hidden on excluded path",n)}const i="true"===localStorage.getItem("site2crm_hide_chat"),s=document.cookie.includes("site2crm_hide_chat=true");if(i||s)return void console.log("Site2CRM Chat Widget: Hidden for authenticated user");const o="https://api.site2crm.io/api/public/chat-widget";const a=function(){const n=sessionStorage.getItem("s2c_chat_session");if(n)return n;const e="s2c_"+Date.now().toString(36)+"_"+Math.random().toString(36).substr(2,9);return sessionStorage.setItem("s2c_chat_session",e),e}();let r,c,d,l,p,g,u,h=!1,x=!1,b=null,f=[];const m={small:{size:48,icon:24},medium:{size:60,icon:28},large:{size:72,icon:32}};const v={chat:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12c0 1.85.53 3.57 1.42 5.04L2 22l4.96-1.42C8.43 21.47 10.15 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.61 0-3.11-.46-4.38-1.25l-.31-.19-3.23.92.92-3.23-.19-.31A7.932 7.932 0 014 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z"/></svg>',message:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/></svg>',support:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>',robot:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 9V7c0-1.1-.9-2-2-2h-3c0-1.66-1.34-3-3-3S9 3.34 9 5H6c-1.1 0-2 .9-2 2v2c-1.66 0-3 1.34-3 3s1.34 3 3 3v4c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-4c1.66 0 3-1.34 3-3s-1.34-3-3-3zM7.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5S9.83 13 9 13s-1.5-.67-1.5-1.5zM16 17H8v-2h8v2zm-1-4c-.83 0-1.5-.67-1.5-1.5S14.17 10 15 10s1.5.67 1.5 1.5S15.83 13 15 13z"/></svg>',sparkle:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2zm0 4.4l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4l-3.77 2.58 1-4.28-3.32-2.88 4.38-.38L12 6.4z"/></svg>',wave:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2v11h3v9l7-12h-4l3-8H7z"/></svg>'},y='<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',w='<svg viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>';async function k(){try{const n=await fetch(`${o}/config/${e}`);if(!n.ok)return void console.warn("Site2CRM Chat Widget: Unable to load config");b=await n.json();const t=document.createElement("style");t.textContent=function(n){const e=n.primary_color||"#4f46e5",t=n.chat_bg_color||"#1e1b4b",i=n.user_bubble_color||e,s=n.bot_bubble_color||"#2d2a5e",o=m[n.button_size]||m.medium;return`\n    .s2c-widget * {\n      box-sizing: border-box;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;\n      margin: 0;\n      padding: 0;\n    }\n\n    .s2c-bubble {\n      position: fixed;\n      width: ${o.size}px;\n      height: ${o.size}px;\n      border-radius: 50%;\n      cursor: pointer;\n      box-shadow: 0 4px 20px rgba(79, 70, 229, 0.4);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: transform 0.2s ease, box-shadow 0.2s ease;\n      z-index: 999998;\n      background: linear-gradient(135deg, ${e} 0%, #7c3aed 100%);\n    }\n\n    .s2c-bubble:hover {\n      transform: scale(1.08);\n      box-shadow: 0 6px 25px rgba(79, 70, 229, 0.5);\n    }\n\n    .s2c-bubble svg {\n      width: ${o.icon}px;\n      height: ${o.icon}px;\n      fill: white;\n    }\n\n    .s2c-bubble.bottom-right {\n      bottom: 24px;\n      right: 24px;\n    }\n\n    .s2c-bubble.bottom-left {\n      bottom: 24px;\n      left: 24px;\n    }\n\n    .s2c-window {\n      position: fixed;\n      width: 380px;\n      height: 520px;\n      max-height: calc(100vh - 100px);\n      border-radius: 16px;\n      background: #1e1b4b;\n      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);\n      display: none;\n      flex-direction: column;\n      overflow: hidden;\n      z-index: 999999;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .s2c-window.open {\n      display: flex;\n      animation: s2c-slide-up 0.3s ease;\n    }\n\n    @keyframes s2c-slide-up {\n      from {\n        opacity: 0;\n        transform: translateY(20px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    .s2c-window.bottom-right {\n      bottom: ${o.size+35}px;\n      right: 24px;\n    }\n\n    .s2c-window.bottom-left {\n      bottom: ${o.size+35}px;\n      left: 24px;\n    }\n\n    @media (max-width: 480px) {\n      .s2c-window {\n        width: calc(100vw - 20px);\n        height: calc(100vh - 120px);\n        bottom: ${o.size+35}px;\n        right: 10px;\n        left: 10px;\n        border-radius: 16px;\n      }\n    }\n\n    .s2c-header {\n      padding: 16px 20px;\n      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      flex-shrink: 0;\n    }\n\n    .s2c-header-info {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .s2c-header-title {\n      font-size: 16px;\n      font-weight: 600;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .s2c-header-title::before {\n      content: '';\n      width: 8px;\n      height: 8px;\n      background: #22c55e;\n      border-radius: 50%;\n      flex-shrink: 0;\n      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);\n    }\n\n    .s2c-header-subtitle {\n      font-size: 13px;\n      opacity: 0.9;\n      margin-top: 2px;\n      margin-left: 16px;\n    }\n\n    .s2c-close {\n      background: rgba(255, 255, 255, 0.1);\n      border: none;\n      color: white;\n      cursor: pointer;\n      padding: 6px;\n      border-radius: 8px;\n      opacity: 0.9;\n      transition: all 0.2s;\n    }\n\n    .s2c-close:hover {\n      opacity: 1;\n      background: rgba(255, 255, 255, 0.2);\n    }\n\n    .s2c-close svg {\n      width: 18px;\n      height: 18px;\n      display: block;\n    }\n\n    .s2c-messages {\n      flex: 1;\n      padding: 16px;\n      overflow-y: auto;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n      background: ${t};\n    }\n\n    .s2c-message {\n      max-width: 80%;\n      padding: 12px 16px;\n      font-size: 14px;\n      line-height: 1.5;\n      animation: s2c-fade-in 0.2s ease;\n    }\n\n    @keyframes s2c-fade-in {\n      from {\n        opacity: 0;\n        transform: translateY(8px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n\n    .s2c-message.user {\n      align-self: flex-end;\n      background: ${i};\n      color: white;\n      border-radius: 16px 16px 4px 16px;\n    }\n\n    .s2c-message.assistant {\n      align-self: flex-start;\n      background: ${s};\n      color: #e5e7eb;\n      border-radius: 16px 16px 16px 4px;\n    }\n\n    .s2c-typing {\n      display: flex;\n      gap: 4px;\n      padding: 14px 18px;\n      align-self: flex-start;\n      background: ${s};\n      border-radius: 16px 16px 16px 4px;\n    }\n\n    .s2c-typing-dot {\n      width: 8px;\n      height: 8px;\n      background: #9ca3af;\n      border-radius: 50%;\n      animation: s2c-typing 1.2s ease-in-out infinite;\n    }\n\n    .s2c-typing-dot:nth-child(2) {\n      animation-delay: 0.15s;\n    }\n\n    .s2c-typing-dot:nth-child(3) {\n      animation-delay: 0.3s;\n    }\n\n    @keyframes s2c-typing {\n      0%, 100% {\n        opacity: 0.4;\n        transform: scale(0.8);\n      }\n      50% {\n        opacity: 1;\n        transform: scale(1);\n      }\n    }\n\n    .s2c-quick-replies {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 8px;\n      padding: 0 16px 12px;\n      background: ${t};\n    }\n\n    .s2c-quick-reply {\n      padding: 8px 16px;\n      background: #2d2a5e;\n      border: 1px solid rgba(255, 255, 255, 0.15);\n      border-radius: 20px;\n      font-size: 13px;\n      color: #e5e7eb;\n      cursor: pointer;\n      transition: all 0.2s;\n      font-weight: 500;\n    }\n\n    .s2c-quick-reply:hover {\n      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n      color: white;\n      border-color: transparent;\n      transform: translateY(-1px);\n    }\n\n    .s2c-input-area {\n      padding: 16px;\n      display: flex;\n      gap: 10px;\n      background: #1e1b4b;\n      flex-shrink: 0;\n      border-top: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .s2c-input {\n      flex: 1;\n      padding: 12px 18px;\n      border: none;\n      border-radius: 24px;\n      font-size: 14px;\n      outline: none;\n      transition: all 0.2s;\n      color: #e5e7eb;\n      background: #2d2a5e;\n    }\n\n    .s2c-input:focus {\n      background: #3d3a6e;\n    }\n\n    .s2c-input::placeholder {\n      color: #9ca3af;\n    }\n\n    .s2c-send {\n      width: 44px;\n      height: 44px;\n      border: none;\n      border-radius: 50%;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.2s;\n      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n      flex-shrink: 0;\n    }\n\n    .s2c-send:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .s2c-send:not(:disabled):hover {\n      transform: scale(1.05);\n      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);\n    }\n\n    .s2c-send svg {\n      width: 18px;\n      height: 18px;\n      fill: white;\n    }\n\n    .s2c-powered {\n      padding: 10px;\n      text-align: center;\n      font-size: 11px;\n      color: #9ca3af;\n      background: #1e1b4b;\n    }\n\n    .s2c-powered a {\n      color: #a5b4fc;\n      text-decoration: none;\n      font-weight: 500;\n    }\n\n    .s2c-powered a:hover {\n      color: #c7d2fe;\n    }\n\n    .s2c-powered.hidden {\n      display: none;\n    }\n\n    .s2c-link-btn {\n      display: inline-block;\n      margin-top: 10px;\n      padding: 12px 24px;\n      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n      color: white !important;\n      text-decoration: none;\n      border-radius: 24px;\n      font-weight: 600;\n      font-size: 14px;\n      transition: all 0.2s;\n      box-shadow: 0 4px 14px rgba(79, 70, 229, 0.4);\n    }\n\n    .s2c-link-btn:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 6px 20px rgba(79, 70, 229, 0.5);\n    }\n  `}(b),document.head.appendChild(t),function(){const n=b.widget_position||"bottom-right",e=(b.primary_color,b.bubble_icon||"chat"),t=v[e]||v.chat,i=b.header_title||b.business_name,s=b.header_subtitle||"",o=!1!==b.show_branding;r=document.createElement("div"),r.className="s2c-widget",c=document.createElement("div"),c.className=`s2c-bubble ${n}`,c.innerHTML=t,c.addEventListener("click",C);let a=`\n      <div class="s2c-header-info">\n        <div class="s2c-header-title">${$(i)}</div>\n        ${s?`<div class="s2c-header-subtitle">${$(s)}</div>`:""}\n      </div>\n      <button class="s2c-close">${y}</button>\n    `,h="";b.quick_replies&&b.quick_replies.length>0&&(h=`\n        <div class="s2c-quick-replies">\n          ${b.quick_replies.map(n=>`<button class="s2c-quick-reply">${$(n)}</button>`).join("")}\n        </div>\n      `);const x=o?'<div class="s2c-powered">Powered by <a href="https://site2crm.io" target="_blank" rel="noopener">Site2CRM</a></div>':'<div class="s2c-powered hidden"></div>';d=document.createElement("div"),d.className=`s2c-window ${n}`,d.innerHTML=`\n      <div class="s2c-header">${a}</div>\n      <div class="s2c-messages"></div>\n      ${h}\n      <div class="s2c-input-area">\n        <input type="text" class="s2c-input" placeholder="Type a message..." />\n        <button class="s2c-send">${w}</button>\n      </div>\n      ${x}\n    `,l=d.querySelector(".s2c-messages"),p=d.querySelector(".s2c-input"),g=d.querySelector(".s2c-send"),u=d.querySelector(".s2c-quick-replies");d.querySelector(".s2c-close").addEventListener("click",C),g.addEventListener("click",_),p.addEventListener("keypress",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),_())}),u&&u.querySelectorAll(".s2c-quick-reply").forEach(n=>{n.addEventListener("click",()=>{p.value=n.textContent,_(),u.style.display="none"})});r.appendChild(c),r.appendChild(d),document.body.appendChild(r),b.greeting&&z("assistant",b.greeting)}()}catch(n){console.error("Site2CRM Chat Widget: Init failed",n)}}function C(){h=!h,d.classList.toggle("open",h),h&&p.focus()}function z(n,e){f.push({role:n,content:e});const t=document.createElement("div");t.className=`s2c-message ${n}`,"assistant"===n?t.innerHTML=function(n){const e=/(https?:\/\/[^\s<]+[^\s<.,;:'")\]])/g;let t=$(n);return t=t.replace(e,n=>{let e="Click here";return n.includes("/signup")?e="Sign Up Free":n.includes("/pricing")?e="View Pricing":n.includes("/demo")||n.includes("calendly")||n.includes("cal.com")?e="Book Demo":n.includes("/trial")?e="Start Free Trial":n.includes("/contact")&&(e="Contact Us"),`<a href="${n}" target="_blank" rel="noopener" class="s2c-link-btn">${e}</a>`}),t}(e):t.textContent=e,l.appendChild(t),l.scrollTop=l.scrollHeight}function S(){const n=document.getElementById("s2c-typing");n&&n.remove()}async function _(){const n=p.value.trim();if(n&&!x){u&&(u.style.display="none"),z("user",n),p.value="",p.disabled=!0,g.disabled=!0,x=!0,function(){const n=document.createElement("div");n.className="s2c-typing",n.id="s2c-typing",n.innerHTML='\n      <div class="s2c-typing-dot"></div>\n      <div class="s2c-typing-dot"></div>\n      <div class="s2c-typing-dot"></div>\n    ',l.appendChild(n),l.scrollTop=l.scrollHeight}();try{const t=await fetch(`${o}/message?widget_key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:a,message:n,page_url:window.location.href})});if(S(),!t.ok)throw new Error("API error");const i=await t.json();z("assistant",i.response),i.lead_captured&&console.log("Site2CRM: Lead captured",i.captured_email||i.captured_phone)}catch(n){S(),z("assistant","Sorry, I'm having trouble connecting. Please try again in a moment."),console.error("Site2CRM Chat Widget: Send failed",n)}finally{p.disabled=!1,g.disabled=!1,x=!1,p.focus()}}}function $(n){const e=document.createElement("div");return e.textContent=n,e.innerHTML}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",k):k()}();