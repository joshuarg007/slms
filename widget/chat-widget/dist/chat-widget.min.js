!function(){"use strict";const n=document.currentScript,e=n?.getAttribute("data-widget-key");if(!e)return void console.error("Site2CRM Chat Widget: Missing data-widget-key attribute");const t=n?.getAttribute("data-exclude-paths");if(t){const n=window.location.pathname,e=t.split(",").map(n=>n.trim());for(const t of e)if(t.endsWith("*")){const e=t.slice(0,-1);if(n.startsWith(e))return void console.log("Site2CRM Chat Widget: Hidden on excluded path",n)}else if(n===t)return void console.log("Site2CRM Chat Widget: Hidden on excluded path",n)}const o="true"===localStorage.getItem("site2crm_hide_chat"),i=document.cookie.includes("site2crm_hide_chat=true");if(o||i)return void console.log("Site2CRM Chat Widget: Hidden for authenticated user");const r="https://api.site2crm.io/api/public/chat-widget";const s=function(){const n=sessionStorage.getItem("s2c_chat_session");if(n)return n;const e="s2c_"+Date.now().toString(36)+"_"+Math.random().toString(36).substr(2,9);return sessionStorage.setItem("s2c_chat_session",e),e}();let a,c,l,d,p,u,b,g=!1,x=!1,h=null,f=[];const m={small:{size:52,icon:26},medium:{size:64,icon:30},large:{size:76,icon:36}};const y={chat:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>\n      <circle cx="12" cy="12" r="1" fill="currentColor"/><circle cx="8" cy="12" r="1" fill="currentColor"/><circle cx="16" cy="12" r="1" fill="currentColor"/>\n    </svg>',message:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>\n      <polyline points="22,6 12,13 2,6"/>\n      <line x1="2" y1="20" x2="8" y2="14" opacity="0.5"/><line x1="22" y1="20" x2="16" y2="14" opacity="0.5"/>\n    </svg>',support:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M3 18v-6a9 9 0 0 1 18 0v6"/>\n      <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/>\n      <circle cx="12" cy="12" r="2" opacity="0.4"/><path d="M12 14v3" opacity="0.4"/>\n    </svg>',robot:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">\n      <rect x="3" y="8" width="18" height="12" rx="2"/>\n      <circle cx="9" cy="14" r="1.5" fill="currentColor"/><circle cx="15" cy="14" r="1.5" fill="currentColor"/>\n      <path d="M12 2v4"/><circle cx="12" cy="2" r="1" fill="currentColor"/>\n      <path d="M8 17h8" stroke-linecap="round"/>\n      <path d="M1 12h2M21 12h2" opacity="0.5"/>\n    </svg>',sparkle:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M12 2l2.4 7.2H22l-6.2 4.5 2.4 7.3L12 16.5 5.8 21l2.4-7.3L2 9.2h7.6L12 2z"/>\n      <circle cx="19" cy="5" r="1.5" fill="currentColor" opacity="0.6"/>\n      <circle cx="5" cy="19" r="1" fill="currentColor" opacity="0.4"/>\n      <path d="M19 2v2M18 3h2" opacity="0.5"/>\n    </svg>',wave:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">\n      <path d="M13 2L4 14h7l-1 8 9-12h-7l1-8z"/>\n      <path d="M17 6l2-2M19 10h2M17 14l2 2" opacity="0.4"/>\n    </svg>',ai:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">\n      <circle cx="12" cy="12" r="9"/>\n      <circle cx="12" cy="12" r="4" opacity="0.5"/>\n      <circle cx="12" cy="12" r="1" fill="currentColor"/>\n      <path d="M12 3v2M12 19v2M3 12h2M19 12h2" opacity="0.6"/>\n      <path d="M5.6 5.6l1.4 1.4M17 17l1.4 1.4M5.6 18.4l1.4-1.4M17 7l1.4-1.4" opacity="0.4"/>\n    </svg>'},w='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',k='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>',v='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>';async function $(){try{const n=await fetch(`${r}/config/${e}`);if(!n.ok)return void console.warn("Site2CRM Chat Widget: Unable to load config");h=await n.json();const t=document.createElement("style");t.textContent=function(n){const e=n.primary_color||"#6366f1",t=n.chat_bg_color||"#0f0f23",o=n.user_bubble_color||e,i=n.bot_bubble_color||"#1e1e3f",r=m[n.button_size]||m.medium,s=n.button_shape||"bubble",a=n.gradient_type||"none",c=n.gradient_color_1,l=n.gradient_color_2,d=n.gradient_color_3,p=null!=n.gradient_angle?n.gradient_angle:135,u=null!=n.button_opacity?n.button_opacity:1,b=n.blur_background||!1,g=n.attention_effect||"none",x=n.shadow_style||"elevated",h=n.entry_animation||"scale",f=n=>{const e=n.replace("#","");return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]},y=f(e),w=n=>`rgba(${y[0]}, ${y[1]}, ${y[2]}, ${n})`,k=((n,e)=>{const[t,o,i]=f(n);return`rgb(${Math.min(255,t+e)}, ${Math.min(255,o+e)}, ${Math.min(255,i+e)})`})(e,40),v={sunset:["#f97316","#ec4899"],ocean:["#06b6d4","#3b82f6"],forest:["#22c55e","#14b8a6"],purple:["#8b5cf6","#ec4899"],fire:["#ef4444","#f97316"],midnight:["#1e3a8a","#7c3aed"],aurora:["#06b6d4","#8b5cf6","#ec4899"]};let $;if("none"===a)$=e;else if("custom"===a){const n=[c,l,d].filter(Boolean);$=n.length>1?`linear-gradient(${p}deg, ${n.join(", ")})`:e}else $=v[a]?`linear-gradient(${p}deg, ${v[a].join(", ")})`:e;const _={bubble:{radius:"50%",width:`${r.size}px`,height:`${r.size}px`,layout:"icon"},pill:{radius:"9999px",width:1.8*r.size+"px",height:.85*r.size+"px",layout:"icon-text"},square:{radius:"16px",width:`${r.size}px`,height:`${r.size}px`,layout:"icon"},tab:{radius:"12px 0 0 12px",width:.7*r.size+"px",height:1.6*r.size+"px",layout:"icon-vertical"},bar:{radius:"16px 16px 0 0",width:3*r.size+"px",height:.75*r.size+"px",layout:"icon-text"}},C=_[s]||_.bubble,M={none:"none",subtle:"0 4px 12px rgba(0,0,0,0.15)",elevated:`0 8px 32px ${w(.4)}, 0 0 0 1px rgba(255, 255, 255, 0.1) inset, 0 2px 4px rgba(0, 0, 0, 0.1)`,dramatic:`0 20px 60px rgba(0,0,0,0.4), 0 8px 24px ${w(.3)}`,glow:`0 0 20px ${e}80, 0 0 40px ${e}40, 0 8px 32px rgba(0,0,0,0.3)`},z=M[x]||M.elevated,S="none"===x?"none":"glow"===x?`0 0 30px ${e}90, 0 0 60px ${e}60, 0 12px 40px rgba(0,0,0,0.3)`:"dramatic"===x?`0 24px 70px rgba(0,0,0,0.5), 0 12px 32px ${w(.4)}`:`0 12px 40px ${w(.5)}, 0 0 0 1px rgba(255, 255, 255, 0.15) inset, 0 4px 8px rgba(0, 0, 0, 0.15)`;let L,E,j="",Y="none",q="";return"pulse"===g?(Y="s2c-pulse 2s ease-out infinite",q="\n        @keyframes s2c-pulse {\n          0% { transform: scale(1); opacity: 0.5; }\n          100% { transform: scale(1.4); opacity: 0; }\n        }"):"bounce"===g?(j="animation: s2c-bounce 2s ease-in-out infinite;",q="\n        @keyframes s2c-bounce {\n          0%, 100% { transform: translateY(0); }\n          50% { transform: translateY(-8px); }\n        }"):"glow"===g?(j="animation: s2c-glow 2s ease-in-out infinite;",q=`\n        @keyframes s2c-glow {\n          0%, 100% { box-shadow: ${z}; }\n          50% { box-shadow: 0 0 30px ${e}90, 0 0 60px ${e}50, 0 8px 32px rgba(0,0,0,0.3); }\n        }`):"shake"===g?(j="animation: s2c-shake 3s ease-in-out infinite;",q="\n        @keyframes s2c-shake {\n          0%, 90%, 100% { transform: rotate(0); }\n          92% { transform: rotate(-8deg); }\n          94% { transform: rotate(8deg); }\n          96% { transform: rotate(-6deg); }\n          98% { transform: rotate(6deg); }\n        }"):"ring"===g&&(Y="s2c-ring 2s ease-out infinite",q=`\n        @keyframes s2c-ring {\n          0% { transform: scale(1); opacity: 0.6; box-shadow: 0 0 0 0 ${e}80; }\n          100% { transform: scale(1.5); opacity: 0; box-shadow: 0 0 0 12px ${e}00; }\n        }`),"fade"===h?(L="s2c-fade-in",E="\n        @keyframes s2c-fade-in {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }"):"slide"===h?(L="s2c-slide-in",E="\n        @keyframes s2c-slide-in {\n          from { opacity: 0; transform: translateY(40px); }\n          to { opacity: 1; transform: translateY(0); }\n        }"):"bounce"===h?(L="s2c-bounce-in",E="\n        @keyframes s2c-bounce-in {\n          0% { opacity: 0; transform: translateY(30px) scale(0.9); }\n          50% { transform: translateY(-8px) scale(1.02); }\n          100% { opacity: 1; transform: translateY(0) scale(1); }\n        }"):"none"===h?(L="none",E=""):(L="s2c-scale-in",E="\n        @keyframes s2c-scale-in {\n          from { opacity: 0; transform: translateY(24px) scale(0.95); }\n          to { opacity: 1; transform: translateY(0) scale(1); }\n        }"),`\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n\n    .s2c-widget * {\n      box-sizing: border-box;\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      margin: 0;\n      padding: 0;\n    }\n\n    .s2c-bubble {\n      position: fixed;\n      width: ${C.width};\n      height: ${C.height};\n      border-radius: ${C.radius};\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      ${"icon-text"===C.layout?"gap: 8px;":""}\n      ${"icon-vertical"===C.layout?"flex-direction: column;":""}\n      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n      z-index: 999998;\n      background: ${$};\n      opacity: ${u};\n      box-shadow: ${z};\n      ${b?"backdrop-filter: blur(10px);":""}\n      ${j}\n    }\n\n    .s2c-bubble::before {\n      content: '';\n      position: absolute;\n      inset: 0;\n      border-radius: ${C.radius};\n      padding: 1px;\n      background: linear-gradient(135deg, rgba(255,255,255,0.3), rgba(255,255,255,0.05));\n      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n      -webkit-mask-composite: xor;\n      mask-composite: exclude;\n      pointer-events: none;\n    }\n\n    .s2c-bubble:hover {\n      transform: scale(1.1) translateY(-2px);\n      box-shadow: ${S};\n    }\n\n    .s2c-bubble:active {\n      transform: scale(1.05);\n    }\n\n    .s2c-bubble svg {\n      width: ${r.icon}px;\n      height: ${r.icon}px;\n      color: white;\n      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));\n      transition: transform 0.3s ease;\n    }\n\n    .s2c-bubble .s2c-bubble-label {\n      color: white;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n    }\n\n    .s2c-bubble:hover svg {\n      transform: scale(1.1);\n    }\n\n    .s2c-bubble.bottom-right {\n      bottom: ${"bar"===s?"0":"24px"};\n      right: ${"tab"===s?"0":"24px"};\n    }\n\n    .s2c-bubble.bottom-left {\n      bottom: ${"bar"===s?"0":"24px"};\n      left: ${"tab"===s?"0":"24px"};\n    }\n\n    ${"tab"===s?"\n    .s2c-bubble.bottom-left {\n      border-radius: 0 12px 12px 0;\n    }":""}\n\n    ${"bar"===s?"\n    .s2c-bubble.bottom-right,\n    .s2c-bubble.bottom-left {\n      right: auto;\n      left: 50%;\n      transform: translateX(-50%);\n    }\n    .s2c-bubble.bottom-right:hover,\n    .s2c-bubble.bottom-left:hover {\n      transform: translateX(-50%) translateY(-2px);\n    }":""}\n\n    /* Attention effect */\n    .s2c-bubble::after {\n      content: '';\n      position: absolute;\n      width: 100%;\n      height: 100%;\n      border-radius: ${C.radius};\n      background: inherit;\n      animation: ${Y};\n      z-index: -1;\n      ${"none"===Y?"display: none;":""}\n    }\n\n    ${q}\n\n    .s2c-window {\n      position: fixed;\n      width: 400px;\n      height: 560px;\n      max-height: calc(100vh - 100px);\n      border-radius: 24px;\n      background: linear-gradient(180deg, ${t} 0%, #0a0a1a 100%);\n      box-shadow:\n        0 32px 64px -12px rgba(0, 0, 0, 0.5),\n        0 0 0 1px rgba(255, 255, 255, 0.08),\n        0 0 80px ${w(.15)};\n      display: none;\n      flex-direction: column;\n      overflow: hidden;\n      z-index: 999999;\n    }\n\n    .s2c-window.open {\n      display: flex;\n      animation: ${L} 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);\n    }\n\n    ${E}\n\n    .s2c-window.bottom-right {\n      bottom: ${r.size+40}px;\n      right: 24px;\n    }\n\n    .s2c-window.bottom-left {\n      bottom: ${r.size+40}px;\n      left: 24px;\n    }\n\n    @media (max-width: 480px) {\n      .s2c-window {\n        width: calc(100vw - 16px);\n        height: 65vh !important;\n        max-height: 450px !important;\n        bottom: 70px !important;\n        right: 8px !important;\n        left: 8px !important;\n        border-radius: 20px;\n      }\n      .s2c-bubble {\n        bottom: ${"bar"===s?"0":"16px"} !important;\n        right: ${"tab"===s?"0":"16px"} !important;\n      }\n    }\n\n    .s2c-header {\n      padding: 20px 24px;\n      background: ${$.includes("gradient")?$:`linear-gradient(135deg, ${e} 0%, ${k} 100%)`};\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      flex-shrink: 0;\n      position: relative;\n      overflow: hidden;\n    }\n\n    .s2c-header::before {\n      content: '';\n      position: absolute;\n      top: -50%;\n      right: -20%;\n      width: 200px;\n      height: 200px;\n      background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);\n      pointer-events: none;\n    }\n\n    .s2c-header-info {\n      display: flex;\n      flex-direction: column;\n      position: relative;\n      z-index: 1;\n    }\n\n    .s2c-header-title {\n      font-size: 17px;\n      font-weight: 700;\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      letter-spacing: -0.02em;\n    }\n\n    .s2c-status-dot {\n      width: 10px;\n      height: 10px;\n      background: #22c55e;\n      border-radius: 50%;\n      flex-shrink: 0;\n      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.25), 0 0 12px rgba(34, 197, 94, 0.5);\n      animation: s2c-status-pulse 2s ease-in-out infinite;\n    }\n\n    @keyframes s2c-status-pulse {\n      0%, 100% { box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.25), 0 0 12px rgba(34, 197, 94, 0.5); }\n      50% { box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.15), 0 0 20px rgba(34, 197, 94, 0.6); }\n    }\n\n    .s2c-header-subtitle {\n      font-size: 13px;\n      opacity: 0.9;\n      margin-top: 4px;\n      margin-left: 20px;\n      font-weight: 500;\n    }\n\n    .s2c-close {\n      background: rgba(255, 255, 255, 0.15);\n      border: none;\n      color: white;\n      cursor: pointer;\n      padding: 8px;\n      border-radius: 12px;\n      transition: all 0.2s ease;\n      position: relative;\n      z-index: 1;\n      backdrop-filter: blur(10px);\n    }\n\n    .s2c-close:hover {\n      background: rgba(255, 255, 255, 0.25);\n      transform: scale(1.05);\n    }\n\n    .s2c-close svg {\n      width: 18px;\n      height: 18px;\n      display: block;\n    }\n\n    .s2c-messages {\n      flex: 1;\n      padding: 20px;\n      overflow-y: auto;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n      background: ${t};\n      scrollbar-width: thin;\n      scrollbar-color: rgba(255,255,255,0.1) transparent;\n    }\n\n    .s2c-messages::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    .s2c-messages::-webkit-scrollbar-track {\n      background: transparent;\n    }\n\n    .s2c-messages::-webkit-scrollbar-thumb {\n      background: rgba(255,255,255,0.1);\n      border-radius: 3px;\n    }\n\n    .s2c-message {\n      max-width: 85%;\n      padding: 14px 18px;\n      font-size: 14px;\n      line-height: 1.6;\n      animation: s2c-message-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n      letter-spacing: -0.01em;\n    }\n\n    @keyframes s2c-message-in {\n      from {\n        opacity: 0;\n        transform: translateY(12px) scale(0.95);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n      }\n    }\n\n    .s2c-message.user {\n      align-self: flex-end;\n      background: linear-gradient(135deg, ${o} 0%, ${k} 100%);\n      color: white;\n      border-radius: 20px 20px 6px 20px;\n      box-shadow: 0 4px 16px ${w(.3)};\n    }\n\n    .s2c-message.assistant {\n      align-self: flex-start;\n      background: ${i};\n      color: #e5e7eb;\n      border-radius: 20px 20px 20px 6px;\n      border: 1px solid rgba(255, 255, 255, 0.06);\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n    }\n\n    .s2c-typing {\n      display: flex;\n      gap: 6px;\n      padding: 16px 20px;\n      align-self: flex-start;\n      background: ${i};\n      border-radius: 20px 20px 20px 6px;\n      border: 1px solid rgba(255, 255, 255, 0.06);\n    }\n\n    .s2c-typing-dot {\n      width: 8px;\n      height: 8px;\n      background: linear-gradient(135deg, ${e}, ${k});\n      border-radius: 50%;\n      animation: s2c-typing 1.4s ease-in-out infinite;\n    }\n\n    .s2c-typing-dot:nth-child(2) {\n      animation-delay: 0.2s;\n    }\n\n    .s2c-typing-dot:nth-child(3) {\n      animation-delay: 0.4s;\n    }\n\n    @keyframes s2c-typing {\n      0%, 100% {\n        opacity: 0.3;\n        transform: scale(0.8) translateY(0);\n      }\n      50% {\n        opacity: 1;\n        transform: scale(1) translateY(-4px);\n      }\n    }\n\n    .s2c-quick-replies {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 10px;\n      padding: 0 20px 16px;\n      background: ${t};\n    }\n\n    .s2c-quick-reply {\n      padding: 10px 18px;\n      background: ${w(.1)};\n      border: 1px solid ${w(.3)};\n      border-radius: 24px;\n      font-size: 13px;\n      color: ${k};\n      cursor: pointer;\n      transition: all 0.25s ease;\n      font-weight: 600;\n      letter-spacing: -0.01em;\n    }\n\n    .s2c-quick-reply:hover {\n      background: linear-gradient(135deg, ${e} 0%, ${k} 100%);\n      color: white;\n      border-color: transparent;\n      transform: translateY(-2px);\n      box-shadow: 0 4px 16px ${w(.4)};\n    }\n\n    .s2c-input-area {\n      padding: 16px 20px 20px;\n      display: flex;\n      gap: 12px;\n      background: linear-gradient(180deg, ${t} 0%, #080814 100%);\n      flex-shrink: 0;\n      border-top: 1px solid rgba(255, 255, 255, 0.06);\n    }\n\n    .s2c-input {\n      flex: 1;\n      padding: 14px 20px;\n      border: 1px solid rgba(255, 255, 255, 0.1);\n      border-radius: 16px;\n      font-size: 14px;\n      outline: none;\n      transition: all 0.25s ease;\n      color: #f3f4f6;\n      background: rgba(255, 255, 255, 0.05);\n      font-weight: 500;\n    }\n\n    .s2c-input:focus {\n      background: rgba(255, 255, 255, 0.08);\n      border-color: ${w(.5)};\n      box-shadow: 0 0 0 3px ${w(.15)};\n    }\n\n    .s2c-input::placeholder {\n      color: #6b7280;\n    }\n\n    .s2c-send {\n      width: 48px;\n      height: 48px;\n      border: none;\n      border-radius: 16px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.25s ease;\n      background: linear-gradient(135deg, ${e} 0%, ${k} 100%);\n      flex-shrink: 0;\n      box-shadow: 0 4px 16px ${w(.3)};\n    }\n\n    .s2c-send:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n      box-shadow: none;\n    }\n\n    .s2c-send:not(:disabled):hover {\n      transform: scale(1.05) translateY(-1px);\n      box-shadow: 0 6px 24px ${w(.45)};\n    }\n\n    .s2c-send:not(:disabled):active {\n      transform: scale(0.98);\n    }\n\n    .s2c-send svg {\n      width: 20px;\n      height: 20px;\n      fill: white;\n    }\n\n    .s2c-powered {\n      padding: 12px;\n      text-align: center;\n      font-size: 11px;\n      color: #6b7280;\n      background: #080814;\n      border-top: 1px solid rgba(255, 255, 255, 0.04);\n    }\n\n    .s2c-powered a {\n      color: ${k};\n      text-decoration: none;\n      font-weight: 600;\n      transition: color 0.2s;\n    }\n\n    .s2c-powered a:hover {\n      color: ${k};\n    }\n\n    .s2c-powered.hidden {\n      display: none;\n    }\n\n    .s2c-link-btn {\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      margin-top: 12px;\n      padding: 12px 24px;\n      background: linear-gradient(135deg, ${e} 0%, ${k} 100%);\n      color: white !important;\n      text-decoration: none;\n      border-radius: 14px;\n      font-weight: 700;\n      font-size: 14px;\n      transition: all 0.25s ease;\n      box-shadow: 0 4px 16px ${w(.35)};\n      letter-spacing: -0.01em;\n    }\n\n    .s2c-link-btn:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 8px 24px ${w(.45)};\n    }\n\n    .s2c-link-btn svg {\n      width: 16px;\n      height: 16px;\n    }\n  `}(h),document.head.appendChild(t),function(){const n=h.widget_position||"bottom-right",e=h.bubble_icon||"sparkle",t=y[e]||y.sparkle,o=h.header_title||h.business_name,i=h.header_subtitle||"Typically replies instantly",r=!1!==h.show_branding;a=document.createElement("div"),a.className="s2c-widget",a.id="site2crm-chat-widget";const s=h.button_shape||"bubble";c=document.createElement("div"),c.className=`s2c-bubble ${n}`,c.innerHTML="pill"===s?`${t}<span class="s2c-bubble-label">Chat</span>`:"bar"===s?`${t}<span class="s2c-bubble-label">Chat with us</span>`:t;c.addEventListener("click",_);let g=`\n      <div class="s2c-header-info">\n        <div class="s2c-header-title">\n          <span class="s2c-status-dot"></span>\n          ${S(o)}\n        </div>\n        ${i?`<div class="s2c-header-subtitle">${S(i)}</div>`:""}\n      </div>\n      <button class="s2c-close">${w}</button>\n    `,x="";h.quick_replies&&h.quick_replies.length>0&&(x=`\n        <div class="s2c-quick-replies">\n          ${h.quick_replies.map(n=>`<button class="s2c-quick-reply">${S(n)}</button>`).join("")}\n        </div>\n      `);const f=r?'<div class="s2c-powered">Powered by <a href="https://site2crm.io" target="_blank" rel="noopener">Site2CRM</a></div>':'<div class="s2c-powered hidden"></div>';l=document.createElement("div"),l.className=`s2c-window ${n}`,l.innerHTML=`\n      <div class="s2c-header">${g}</div>\n      <div class="s2c-messages"></div>\n      ${x}\n      <div class="s2c-input-area">\n        <input type="text" class="s2c-input" placeholder="Type your message..." />\n        <button class="s2c-send">${k}</button>\n      </div>\n      ${f}\n    `,d=l.querySelector(".s2c-messages"),p=l.querySelector(".s2c-input"),u=l.querySelector(".s2c-send"),b=l.querySelector(".s2c-quick-replies");l.querySelector(".s2c-close").addEventListener("click",_),u.addEventListener("click",z),p.addEventListener("keypress",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),z())}),b&&b.querySelectorAll(".s2c-quick-reply").forEach(n=>{n.addEventListener("click",()=>{p.value=n.textContent,z(),b.style.display="none"})});a.appendChild(c),a.appendChild(l),document.body.appendChild(a),h.greeting&&C("assistant",h.greeting)}()}catch(n){console.error("Site2CRM Chat Widget: Init failed",n)}}function _(){g=!g,l.classList.toggle("open",g),g&&p.focus()}function C(n,e){f.push({role:n,content:e});const t=document.createElement("div");t.className=`s2c-message ${n}`,"assistant"===n?t.innerHTML=function(n){function e(n){const e=n.toLowerCase();return e.includes("/signup")||e.includes("/register")?"Sign Up Free":e.includes("/pricing")?"View Pricing":e.includes("/demo")||e.includes("calendly")||e.includes("cal.com")?"Book Demo":e.includes("/trial")?"Start Free Trial":e.includes("/contact")?"Contact Us":e.includes("/schedule")||e.includes("/book")?"Schedule Now":e.includes("/form")||e.includes("/apply")?"Fill Out Form":e.includes("/download")?"Download":(e.includes("/learn")||e.includes("/docs"),"Learn More")}function t(n){return/^https?:\/\//i.test(n)?n:"https://"+n}const o=[];function i(n,i){const r=t(n),s=`<a href="${r}" target="_blank" rel="noopener" class="s2c-link-btn">${i||e(r)} ${v}</a>`,a=`__LINK_PLACEHOLDER_${o.length}__`;return o.push(s),a}let r=n;return r=r.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,e,t)=>i(t,e)),r=r.replace(/(https?:\/\/[^\s<]+[^\s<.,;:'")\]])/gi,n=>i(n)),r=r.replace(/((?:www\.)?[a-zA-Z0-9][-a-zA-Z0-9]*\.(?:com|io|co|org|net|ai|app|dev)(?:\/[^\s<]*[^\s<.,;:'")\]])?)/gi,n=>n.includes("@")?n:i(n)),r=S(r),o.forEach((n,e)=>{r=r.replace(`__LINK_PLACEHOLDER_${e}__`,n)}),r}(e):t.textContent=e,d.appendChild(t),d.scrollTop=d.scrollHeight}function M(){const n=document.getElementById("s2c-typing");n&&n.remove()}async function z(){const n=p.value.trim();if(n&&!x){b&&(b.style.display="none"),C("user",n),p.value="",p.disabled=!0,u.disabled=!0,x=!0,function(){const n=document.createElement("div");n.className="s2c-typing",n.id="s2c-typing",n.innerHTML='\n      <div class="s2c-typing-dot"></div>\n      <div class="s2c-typing-dot"></div>\n      <div class="s2c-typing-dot"></div>\n    ',d.appendChild(n),d.scrollTop=d.scrollHeight}();try{const t=await fetch(`${r}/message?widget_key=${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:s,message:n,page_url:window.location.href,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone})});if(M(),!t.ok)throw new Error("API error");const o=await t.json();C("assistant",o.response),o.lead_captured&&console.log("Site2CRM: Lead captured",o.captured_email||o.captured_phone)}catch(n){M(),C("assistant","Sorry, I'm having trouble connecting. Please try again in a moment."),console.error("Site2CRM Chat Widget: Send failed",n)}finally{p.disabled=!1,u.disabled=!1,x=!1,p.focus()}}}function S(n){const e=document.createElement("div");return e.textContent=n,e.innerHTML}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",$):$()}();